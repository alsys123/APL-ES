
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Spreadsheet Exporter</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
</head>
<body>
  <h1>Export Google Spreadsheet to ZIP</h1>
  <input id="spreadsheetId" placeholder="Enter Spreadsheet ID">
  <button onclick="exportSpreadsheet()">Export</button>

  <script>
    // Load Google API client
    function initClient() {
      gapi.load('client:auth2', () => {
        gapi.client.init({
          apiKey: '<YOUR_API_KEY>',
          clientId: '<YOUR_CLIENT_ID>',
          discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
          scope: "https://www.googleapis.com/auth/spreadsheets.readonly"
        });
      });
    }
    initClient();

    async function exportSpreadsheet() {
      const spreadsheetId = document.getElementById('spreadsheetId').value;
      await gapi.auth2.getAuthInstance().signIn();

      const meta = await gapi.client.sheets.spreadsheets.get({ spreadsheetId });
      const zip = new JSZip();

      for (const sheet of meta.result.sheets) {
        const title = sheet.properties.title;
        const res = await gapi.client.sheets.spreadsheets.values.get({
          spreadsheetId,
          range: title
        });
        const rows = res.result.values || [];
        const csv = rows.map(r => r.join(',')).join('\n');
        zip.file(`${title}.csv`, csv);
      }

      const content = await zip.generateAsync({ type: "blob" });
      saveAs(content, `${spreadsheetId}.zip`);
    }
  </script>
</body>
</html>
